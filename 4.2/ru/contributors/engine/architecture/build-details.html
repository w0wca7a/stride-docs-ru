<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Build details | Stride Contributors </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Build details | Stride Contributors ">
      
      
      <link rel="icon" href="../../../favicon.ico">
      <link rel="stylesheet" href="../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../public/main.css">
      <meta name="docfx:navrel" content="../../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      <meta name="docfx:rel" content="../../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/stride3d/stride-docs/blob/master/en/contributors/engine/architecture/build-details.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="https://www.stride3d.net/">
            <img id="logo" class="svg" src="../../../media/stride-logo-red.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="build-details">Build details</h1>

<p>This is a technical description what happens in our build and how it is organized. This covers mostly the build architecture of Stride itself.</p>
<ul>
<li><a href="../Targets">Targets</a> contains the MSBuild target files used by Games</li>
<li><a href="../sources/common/targets">sources/common/targets</a> (generic) and <a href="https://github.com/stride3d/stride/tree/master/sources/targets">sources/targets</a> (Stride-specific) contains the MSBuild target files used to build Stride itself.</li>
</ul>
<p>Since 3.1, we switched from our custom build system to the new csproj system with one nuget package per assembly.</p>
<p>We use <code>TargetFrameworks</code> to properly compile the different platforms using a single project (Android, iOS, etc...).</p>
<p>Also, we use <code>RuntimeIdentifiers</code> to select graphics platform. <a href="https://github.com/onovotny/MSBuildSdkExtras">MSBuild.Sdk.Extras</a> is used to properly build NuGet packages with multiple <code>RuntimeIdentifiers</code> (not supported out of the box).</p>
<h3 id="limitations">Limitations</h3>
<ul>
<li>Dependencies are per <code>TargetFramework</code> and can't be done per <code>RuntimeIdentifier</code> (tracked in <a href="https://github.com/NuGet/Home/issues/1660">NuGet#1660</a>).</li>
</ul>
<h2 id="nuget-resolver">NuGet resolver</h2>
<p>Since we want to package tools (i.e. GameStudio, ConnectionRouter, CompilerApp) with a package that contains only the executable with proper dependencies to other NuGet runtime packages, we use NuGet API to resolve assemblies at runtime.</p>
<p>The code responsible for this is located in <a href="https://github.com/stride3d/stride/tree/master/sources/shared/Stride.NuGetResolver">Stride.NuGetResolver</a>.</p>
<p>Later, we might want to take advantage of .NET Core dependency resolving to do that natively. Also, we might want to use actual project information/dependencies to resolve to different runtime assemblies and better support plugins.</p>
<h2 id="versioning">Versioning</h2>
<p>Stride is versioned using <code>SharedAssemblyInfo.cs</code>.
For example, assuming version <code>4.1.3.135+gfa0f5cc4</code>:</p>
<ul>
<li><code>4.1</code> is the Stride major and minor version, as they are grouped in the launcher. Versions inside this group shouldn't have breaking changes</li>
<li><code>3</code> is the asset version. This can be bumped if asset files require some upgrade.</li>
<li><code>135</code> is the git height (number of commits since <code>4.1.3</code> is set), computed automatically when building packages.
Note: when building packages locally, this will typically be 1. This is the reason why the asset version needs to be bumped when asset changes to keep things ordered (otherwise the git height version <code>1</code> will always be lower than official version).</li>
<li><code>+gfa0f5cc4</code> means git commit <code>fa0f5cc4</code></li>
</ul>
<h2 id="assembly-processor">Assembly processor</h2>
<p>Assembly processor is run by both Game and Stride targets.</p>
<p>It performs various transforms to the compiled assemblies:</p>
<ul>
<li>Generate <a href="https://github.com/stride3d/stride/blob/master/sources/core/Stride.Core/Serialization/DataSerializer.cs">DataSerializer</a> serialization code (and merge it back in assembly using IL-Repack)</li>
<li>Generate <a href="https://github.com/stride3d/stride/blob/master/sources/engine/Stride.Engine/Updater/UpdateEngine.cs">UpdateEngine</a> code</li>
<li>Scan for types or attributes with <code>[ScanAssembly]</code> to quickly enumerate them without needing <code>Assembly.GetTypes()</code></li>
<li>Optimize calls to <a href="https://github.com/stride3d/stride/blob/master/sources/core/Stride.Core/Utilities.cs">Stride.Core.Utilities</a></li>
<li>Automatically call methods tagged with <a href="https://github.com/stride3d/stride/blob/master/sources/core/Stride.Core/ModuleInitializerAttribute.cs">ModuleInitializer</a></li>
<li>Cache lambdas and various other code generation related to <a href="https://github.com/stride3d/stride/blob/master/sources/core/Stride.Core/Threading/Dispatcher.cs">Dispatcher</a></li>
<li>A few other internal tasks</li>
</ul>
<p>For performance reasons, it is run as a MSBuild Task (avoid reload/JIT-ing). If you wish to make it run the executable directly, set <code>StrideAssemblyProcessorDev</code> to <code>true</code>.</p>
<h2 id="dependencies">Dependencies</h2>
<p>We want an easy mechanism to attach some files to copy alongside a referenced .dll or .exe, including content and native libraries.</p>
<p>As a result, <code>&lt;StrideContent&gt;</code> and <code>&lt;StrideNativeLib&gt;</code> item types were added.</p>
<p>When a project declare them, they will be saved alongside the assembly with extension <code>.ssdeps</code>, to instruct referencing projects what needs to be copied.</p>
<p>Also, for the specific case of <code>&lt;StrideNativeLib&gt;</code>, we automatically copy them in appropriate folders and link them if necessary.</p>
<p>Note: we don't apply them transitively yet (project output won't contains the <code>.ssdeps</code> file anymore so it is mostly useful to reference from executables/apps directly)</p>
<h2 id="native">Native</h2>
<p>By adding a reference to <code>Stride.Native.targets</code>, it is easy to build some C/C++ files that will be compiled on all platforms and automatically added to the <code>.ssdeps</code> file.</p>
<h3 id="limitations-1">Limitations</h3>
<p>It seems that using those optimization don't work well with shadow copying and <a href="https://msdn.microsoft.com/en-us/library/823z9h8w(v=vs.110).aspx">probing privatePath</a>. This forces us to copy the <code>Direct3D11</code> specific assemblies to the top level <code>Windows</code> folder at startup of some tools. This is little bit unfortunate as it seems to disturb the MSBuild assembly searching (happens before <code>$(AssemblySearchPaths)</code>). As a result, inside Stride solution it is necessary to explicitly add <code>&lt;ProjectReference&gt;</code> to the graphics specific assemblies otherwise wrong ones might be picked up.</p>
<p>This will require further investigation to avoid this copying at all.</p>
<h2 id="asset-compiler">Asset Compiler</h2>
<p>Both Games and Stride unit tests are running the asset compiler as part of the build process to create assets.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/stride3d/stride-docs/blob/master/en/contributors/engine/architecture/build-details.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <div class="d-flex flex-column flex-sm-row justify-content-between pt-1 text-center small"><p>Supported by the <a href="https://dotnetfoundation.org/" target="_blank" rel="noopener">.NET Foundation</a></p><p>Made with <a href="https://dotnet.github.io/docfx">docfx</a></p><p>Stride Docs Website v.2.0.0.1</p><p>&copy; .NET Foundation and Contributors</p></div>
        </div>
      </div>
    </footer>
  </body>
</html>
